<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='stylesheet.css') }}">
    <title>BingeSuggest</title>
    <link rel="icon" href="{{ url_for('static', filename='Popcorn-icon.png') }}" />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bree+Serif&family=Coustard:wght@400;900&family=Londrina+Shadow&family=Righteous&family=Ultra&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
  </head>
  <body class="landing-page">
    {% include 'navbar.html' %}

    <div class="container mt-5" id="centralDivLanding">
      <div class="row">
        <div class="col-md-6 movie-row p-3">
          <h3 class="movie-title">{{ data.movieData.Title }}</h3>
          <div class="text-center">
            <img class="movie-poster img-fluid rounded" src="{{ data.movieData.Poster }}" alt="Image not found"/>
          </div>
          <div class="movie-details mt-3">
            <p><strong>Genre:</strong> {{ data.movieData.Genre }}</p>
            <p><strong>Director:</strong> {{ data.movieData.Director }}</p>
            <p><strong>Plot:</strong> {{ data.movieData.Plot }}</p>
          </div>
        </div>

        <div class="col-md-6 discussion-row p-3">
          <h5 class="comments-div-title">Movie Discussion</h5>
          <div id="commentsDiv" class="added-comments-div border rounded p-2"></div>
          <div class="comment-div mt-3 d-flex">
            <input id="inputComment" class="form-control me-2" placeholder="Add your comment here" />
            <button id="commentBtn" class="btn btn-success">Add</button>
          </div>
        </div>
      </div>
    </div>

    <div class="d-none" id="loaderLanding">
      <div class="spinner-border" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>


    <script>
      window.onload =() => {
        const parentElement = $("#commentsDiv");
  
        var data = {{ data|tojson }};
        var ulList = $("#recentMovies")
        $.ajax({
        type: 'GET',
        url: '/movieDiscussion/' + data.movieData.imdbID,
        contentType: "application/json;charset=UTF-8",
        success: async function(response) {
          for(i =0; i< response.length; i++){
            var element = response[i]
            var comment = element.comment
            var c = "different-user-comment"
            var d = $("<div/>",{class:c})
            if (element.user == data.user && element.user != "Anonymous"){
              c = "user-comment"
              d = $("<div/>",{class:c})
            }
            else{
              var user = $("<p/>",{class:"commentUser"}).text(element.user)
              d.append(user)
            }
            var e  = $("<p />",{class:"commentMessage"})
            .text(comment)
            d.append(e)
            parentElement.append(d)
          }
          let b = document.querySelector('#commentsDiv')
          b.scrollTop = b.scrollHeight - b.clientHeight;
        },
        error: async function(error) {
          reject(error);
        }
        });
      }
  
      $(document).on("click","#commentBtn",() =>{
        var comment = $("#inputComment").val()
        $("#inputComment").val("")
        var data = {{ data|tojson }};
        if(comment.replace(/\s/g, "") == ""){
          return
        }
        $.ajax({
        type: 'POST',
        url: '/movieDiscussion/' + data.movieData.imdbID ,
        contentType: "application/json;charset=UTF-8",
        data: JSON.stringify({
          "comment" : comment,
          "user": data.user
        }),
        success: async function(response) {
          var element = response[0]
          const parentElement = $("#commentsDiv");
          var comment = element.comment
          c = "user-comment"
          var e  = $("<p />",{class:c})
          .text(comment)
          parentElement.append(e)
          let b = document.querySelector('#commentsDiv')
          b.scrollTop = b.scrollHeight - b.clientHeight;
        },
        error: async function(error) {
          reject(error);
        }
        });
      })
    </script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js" crossorigin="anonymous"></script>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
  
  </body>
</html>
